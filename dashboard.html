<!DOCTYPE html>
<html>
<head>
  <title>Teacher Dashboard - EduPortal</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    #courseSection {
      margin-top: 20px;
    }
    .course-list li {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 10px;
      background-color: #f0f8ff;
    }
  </style>
</head>
<body>
  <h2 id="greeting">Welcome</h2>
  <p id="details"></p>

  <div id="courseSection" style="display: none;">
    <h3>Add a New Course</h3>
    <form id="courseForm">
      <input type="text" id="courseTitle" placeholder="Course Title" required><br><br>
      <textarea id="courseDesc" placeholder="Course Description" required></textarea><br><br>
      <button type="submit">Add Course</button>
    </form>

    <h3>Your Courses</h3>
    <ul id="courseList" class="course-list"></ul>
  </div>

  <br><br>
  <button id="logoutBtn">Logout</button>

  <script>
    const role = localStorage.getItem("userRole");
    const email = localStorage.getItem("userEmail");
  
    const greeting = document.getElementById("greeting");
    const details = document.getElementById("details");
    const logoutBtn = document.getElementById("logoutBtn");
  
    const form = document.getElementById("courseForm");
    const courseList = document.getElementById("courseList"); // move this up here!
  
    function showCourses() {
      const courses = JSON.parse(localStorage.getItem("courses") || "[]");
      courseList.innerHTML = "";
  
      courses
        .filter(course => course.uploadedBy === email)
        .forEach(course => {
          const li = document.createElement("li");
          li.innerHTML = `<strong>${course.title}</strong><br>${course.description}`;
          courseList.appendChild(li);
        });
    }
  
    if (role === "teacher") {
      greeting.textContent = "Hello Teacher!";
      details.textContent = `You're logged in as ${email}.`;
      document.getElementById("courseSection").style.display = "block";
      showCourses(); // only now we call this
    } else {
      greeting.textContent = "Access Denied";
      details.textContent = "You are not authorized to view this page.";
      document.getElementById("courseSection").style.display = "none";
    }
  
    logoutBtn.addEventListener("click", () => {
      localStorage.clear();
      window.location.href = "login.html";
    });
  
    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const title = document.getElementById("courseTitle").value.trim();
      const desc = document.getElementById("courseDesc").value.trim();
  
      if (!title || !desc) return alert("Please enter both title and description.");
  
      const newCourse = {
        title: title,
        description: desc,
        uploadedBy: email
      };
  
      let courses = JSON.parse(localStorage.getItem("courses") || "[]");
      courses.push(newCourse);
      localStorage.setItem("courses", JSON.stringify(courses));
  
      form.reset();
      showCourses(); // refresh
    });
  </script>
  
</body>
</html>
